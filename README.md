# Distributed Systems Project 2015-2016 #

Group 64 - Campus Alameda

André Águas - 78854 - andre.aguas@ist.utl.pt

Rui Sá - 78324 - rui.sa@ist.utl.pt

João Neto - 78745 - joao.b.neto@ist.utl.pt


Repository:
[abaguas/UpaTransporter](https://github.com/abaguas/UpaTransporter)

-------------------------------------------------------------------------------
## Description

Development of a sistemy basead in Web Services, implemented in the J2EE plarform, to aggregate services of good transporters, similar to Uber's service with passengers.

The main components of the system are clients, a broker, transporters and a name server (UDDI). The transporters publish themselves in the name server and the broker user this server to find them and negotiate the services requested by the clients.
Here is a simple figure of the system's architecture: 

<img src="https://github.com/abaguas/UpaTransporter/blob/master/images/architecture.png" width ="800" height="400">

The broker is the most complex component and is divided in 4 modules:
* *broker-ws* that communicates with the client
* *transporter-ws-cli* that communicates with the transporters
* *ca-ws-cli* that communicates with the CA

The client is just a *broker-ws-cli* module and the transporter a *transporter-ws*.


In addition, the system is composed by other components that guarantee reliability and security. The broker has a primary backup to prevent its failure. The authenticity, fresheness and integrity of the communication between the broker and the transporters are guaranteed using digital signatures. The keys used in this signatures are generated by a CA that was also implemented as part of the project.


The client only communicates with the broker to request services. Then, the broker negotiates with the transporters to try to find the lowest price for the tranport. During this negotiation there are the following states:


<img src="https://github.com/abaguas/UpaTransporter/blob/master/images/states.png" width ="600" height="600"> 


-------------------------------------------------------------------------------
## Dependencies

Refer to INSTALL.md

-------------------------------------------------------------------------------
## Installing instructions


### Environment

[0] Boot the OS

Linux or Mac OS X


[1] Initiate the support servers

JUDDI:
```
./juddi-3.3.2_tomcat-7.0.64_9090/bin/startup.sh
```


[2] Create temporary folder

```
mkdir temp
cd temp/
```


[3] Obtain source code of the project

```
git clone https://github.com/abaguas/UpaTransporter.git (via https) 
git clone git@github.com:abaguas/UpaTransporter.git (via ssh)
```



[4] Install auxiliary libraries and modules

```
cd uddi-naming
mvn clean install
```


### Certificate Authority

[1] Build and execute the **server**

```
cd ca-ws
mvn clean install
mvn exec:java
```

[2] Build the **client**

```
cd ca-ws-cli
mvn clean install
```



### Transporter

[1] Build and execute the **server**

```
cd transporter-ws
mvn clean install
mvn exec:java
```

and in other tab (the tests that will be run on the broker client require 2 transporters executing)

```
cd transporter-ws
mvn exec:java -Dws.i=2
```

[2] Build the **client**

```
cd transporter-ws-cli
mvn clean install
```


### Broker

[1] Build and execute the **server**

```
cd broker-ws
mvn clean install
mvn exec:java
```


[2] Build the client **client**

```
cd broker-ws-cli
mvn clean install
```

-------------------------------------------------------------------------------
## Running instructions


Nas transportadoras existe uma opção -Dws.i que define qual o seu número.
Foram distribuidos certificados para transportadoras até ao número 5.

Nos brokers existe a opçao -Dws.br que define tambem o numero do broker. A falta de argumentos ou o numero 1 dá o nome ao broker principal: 'UpaBroker'. Qualquer outro número define um broker backup de nome 'UpaBrokerN'
Também existe a opção -Dws.nap que define um tempo de espera no broker, para que tarde a resposta ao cliente.
Para iniciar os brokers as tranportadoras e o CA devem estar publicados. A ordem de publicacao dos brokers é indiferente. Mas depois é necessário fazer um 'enter' no principal depois de o backup estar ativo, e depois enter no backup para que ele inicie o timer que verifica se houve ou não falha no Broker principal


Nos clientes do broker foi adicionada a opcão -Dprocess que envia um sigKill ao processo do broker. Esta opçao serve para os testes de IT a apresentar na demonstração.

-------------------------------------------------------------------------------
**FIM**
